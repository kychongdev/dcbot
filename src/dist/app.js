import{EmbedBuilder as e,Client as t,GatewayIntentBits as a,Partials as n,Events as r}from"discord.js";const s=new t({intents:[a.DirectMessages,a.Guilds,a.GuildMessages,a.MessageContent],partials:[n.Message,n.Channel,n.GuildMember,n.User]});s.once(r.ClientReady,(()=>{s.channels.cache.get(process.env.SENDMESSAGECHANNEL).send("BOT啟動 <@1126733371704365067>")})),s.on(r.MessageDelete,(function(t){if(t.channel.id==process.env.CHECKMESSAGECHANNEL){const a=s.channels.cache.get(process.env.SENDMESSAGECHANNEL);if(t.author?.bot)return;if(!t)return;if(!t.author)return;if(t.content){const n={id:t.author.id?t.author.id:"已經失去紀錄",avatarUrl:t.author.id&&t.author.avatar?`https://cdn.discordapp.com/avatars/${t.author?.id}/${t.author?.avatar}`:"https://t3.ftcdn.net/jpg/03/45/05/92/360_F_345059232_CPieT8RIWOUk4JqBkkWkIETYAkmz2b75.jpg",deletedContent:t.content??"已經失去紀錄",createdAt:t.createdAt.toISOString().replace(/T/," ").replace(/\..+/,"")},r=(new e).setColor(39423).setTitle(`刪除訊息 by 用戶${n.id}`).setImage(n.avatarUrl).addFields({name:"內容",value:n.deletedContent},{name:"作者",value:`<@${n.id}>`},{name:"訊息日期",value:n.createdAt}).setTimestamp(new Date);a.send({embeds:[r]})}t?.member?.roles.cache.some((e=>e.id===process.env.BANROLE))?a.send(`用戶 <@${t.author.id}>, ${t.author.username}已經擁有身份組了`):t?.member?.roles.add(process.env.BANROLE),t.attachments.size>0&&a.send({files:[...t.attachments.values()],content:`【圖片】 【${t.createdAt.toISOString().replace(/T/," ").replace(/\..+/,"")}】 <@${t.author?.id}> ${t.author?.username}#${t.author?.discriminator} 刪除了${t.attachments.size}張圖片`})}})),s.on(r.MessageUpdate,(function(t){if(t.channel.id==process.env.CHECKMESSAGECHANNEL){const a=s.channels.cache.get(process.env.SENDMESSAGECHANNEL);if(t.author?.bot)return;const n=(new Date).toISOString().replace(/T/," ").replace(/\..+/,"");if(!t)return;if(!t.author){const e=t.createdAt.toISOString().replace(/T/," ").replace(/\..+/,"");return void a.send(`【緊急】於${n} 對一則${e}的訊息有编辑痕跡但搜索不到刪除者`)}if(t.content===t.reactions.message.content)return void(t.attachments.size>0&&t.attachments.size!==t.reactions.message.attachments.size&&a.send({files:[...t.attachments.values()],content:`【圖片】 【${t.createdAt.toISOString().replace(/T/," ").replace(/\..+/,"")}】 <@${t.author?.id}> ${t.author?.username}#${t.author?.discriminator} 编辑(刪除)了圖片，此為编辑前的圖片`}));const r={id:t.author.id?t.author.id:"已經失去紀錄",avatarUrl:t.author.id&&t.author.avatar?`https://cdn.discordapp.com/avatars/${t.author?.id}/${t.author?.avatar}`:"https://t3.ftcdn.net/jpg/03/45/05/92/360_F_345059232_CPieT8RIWOUk4JqBkkWkIETYAkmz2b75.jpg",deletedContent:t.content??"已經失去紀錄",createdAt:t.createdAt.toISOString().replace(/T/," ").replace(/\..+/,""),nowContent:t.reactions.message.content??"已經失去紀錄"},o=(new e).setColor(39423).setTitle(`编辑訊息 by 用戶${r.id}`).setImage(r.avatarUrl).addFields({name:"原內容",value:r.deletedContent},{name:"現內容",value:r.nowContent},{name:"作者",value:`<@${r.id}>`},{name:"訊息地址",value:`https://discord.com/channels/${t.guildId}/${t.channelId}/${t.id}`},{name:"訊息日期",value:r.createdAt});a.send({embeds:[o]})}})),s.on(r.MessageCreate,(function(t){if(t.channel.id==process.env.CHECKMESSAGECHANNEL){const a=s.channels.cache.get(process.env.SENDMESSAGECHANNEL);if(!t)return;if(t.author?.bot)return;if(!t.member)return;if(!t.author)return;const n=new Date(Date.now()-2592e6);let r=t.member.joinedAt;if(!r)return;const o=r.getHours()+":"+r.getMinutes()+","+r.toDateString(),c={id:t.author.id?t.author.id:"已經失去紀錄",avatarUrl:t.author.id&&t.author.avatar?`https://cdn.discordapp.com/avatars/${t.author?.id}/${t.author?.avatar}`:"https://t3.ftcdn.net/jpg/03/45/05/92/360_F_345059232_CPieT8RIWOUk4JqBkkWkIETYAkmz2b75.jpg",content:t.content??"已經失去紀錄",createdAt:t.createdAt.toISOString().replace(/T/," ").replace(/\..+/,"")};if(r>n){const n=(new e).setColor(39423).setTitle(`【注意】用戶${c.id}`).setImage(c.avatarUrl).addFields({name:"進群日期",value:o},{name:"內容",value:c.content},{name:"作者",value:`<@${c.id}>`},{name:"訊息地址",value:`https://discord.com/channels/${t.guildId}/${t.channelId}/${t.id}`},{name:"訊息日期",value:c.createdAt}).setTimestamp(new Date);a.send({embeds:[n]}),a.send("<@&842646164511785001>"),a.send("<@&1019130937704988725>")}}})),s.login(process.env.TOKEN);export{s as client};
